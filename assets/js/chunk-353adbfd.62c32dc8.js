(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-353adbfd"],{"0d93":function(e,t,i){},"8ba1":function(e,t,i){"use strict";i("0d93")},d78e:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"app-container"},[t("el-button",{attrs:{type:"primary"},on:{click:e.handleAddRole}},[e._v(" "+e._s("permission.addRole")+" ")]),t("el-table",{staticStyle:{width:"100%","margin-top":"30px"},attrs:{data:e.rolesList,border:""}},[t("el-table-column",{attrs:{align:"center",label:"Role Key",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.key)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"Role Name",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.name)+" ")]}}])}),t("el-table-column",{attrs:{align:"header-center",label:"Description"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(t.row.description)+" ")]}}])}),t("el-table-column",{attrs:{align:"center",label:"Operations"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.handleEdit(i)}}},[e._v(" "+e._s("permission.editPermission")+" ")]),t("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(t){return e.handleDelete(i)}}},[e._v(" "+e._s("permission.delete")+" ")])]}}])})],1),t("el-dialog",{attrs:{visible:e.dialogVisible,title:"edit"===e.dialogType?"Edit Role":"New Role"},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("el-form",{attrs:{model:e.role,"label-width":"80px","label-position":"left"}},[t("el-form-item",{attrs:{label:"Name"}},[t("el-input",{attrs:{placeholder:"Role Name"},model:{value:e.role.name,callback:function(t){e.$set(e.role,"name",t)},expression:"role.name"}})],1),t("el-form-item",{attrs:{label:"Desc"}},[t("el-input",{attrs:{autosize:{minRows:2,maxRows:4},type:"textarea",placeholder:"Role Description"},model:{value:e.role.description,callback:function(t){e.$set(e.role,"description",t)},expression:"role.description"}})],1),t("el-form-item",{attrs:{label:"Menus"}},[t("el-tree",{ref:"tree",staticClass:"permission-tree",attrs:{"check-strictly":e.checkStrictly,data:e.routesData,props:e.defaultProps,"show-checkbox":"","node-key":"path"}})],1)],1),t("div",{staticStyle:{"text-align":"right"}},[t("el-button",{attrs:{type:"danger"},on:{click:function(t){e.dialogVisible=!1}}},[e._v(" "+e._s("permission.cancel")+" ")]),t("el-button",{attrs:{type:"primary"},on:{click:e.confirmRole}},[e._v(" "+e._s("permission.confirm")+" ")])],1)],1)],1)},l=[],n=(i("14d9"),i("df7c")),r=i.n(n),o=i("ed08");const a={key:"",name:"",description:"",routes:[]};var c={data(){return{role:Object.assign({},a),routes:[],rolesList:[],dialogVisible:!1,dialogType:"new",checkStrictly:!1,defaultProps:{children:"children",label:"title"}}},computed:{routesData(){return this.routes}},created(){},methods:{async getRoutes(){const e=await getRoutes();this.serviceRoutes=e.data;const t=this.generateRoutes(e.data);this.routes=this.i18n(t)},async getRoles(){const e=await getRoles();this.rolesList=e.data},i18n(e){const t=e.map(e=>(e.title=i18n.t("route."+e.title),e.children&&(e.children=this.i18n(e.children)),e));return t},generateRoutes(e,t="/"){const i=[];for(let s of e){if(s.hidden)continue;const e=this.onlyOneShowingChild(s.children,s);s.children&&e&&!s.alwaysShow&&(s=e);const l={path:r.a.resolve(t,s.path),title:s.meta&&s.meta.title};s.children&&(l.children=this.generateRoutes(s.children,l.path)),i.push(l)}return i},generateArr(e){let t=[];return e.forEach(e=>{if(t.push(e),e.children){const i=this.generateArr(e.children);i.length>0&&(t=[...t,...i])}}),t},handleAddRole(){this.role=Object.assign({},a),this.$refs.tree&&this.$refs.tree.setCheckedNodes([]),this.dialogType="new",this.dialogVisible=!0},handleEdit(e){this.dialogType="edit",this.dialogVisible=!0,this.checkStrictly=!0,this.role=Object(o["b"])(e.row),this.$nextTick(()=>{const e=this.generateRoutes(this.role.routes);this.$refs.tree.setCheckedNodes(this.generateArr(e)),this.checkStrictly=!1})},handleDelete({$index:e,row:t}){this.$confirm("Confirm to remove the role?","Warning",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(async()=>{await deleteRole(t.key),this.rolesList.splice(e,1),this.$message({type:"success",message:"Delete succed!"})}).catch(e=>{console.error(e)})},generateTree(e,t="/",i){const s=[];for(const l of e){const e=r.a.resolve(t,l.path);l.children&&(l.children=this.generateTree(l.children,e,i)),(i.includes(e)||l.children&&l.children.length>=1)&&s.push(l)}return s},async confirmRole(){const e="edit"===this.dialogType,t=this.$refs.tree.getCheckedKeys();if(this.role.routes=this.generateTree(Object(o["b"])(this.serviceRoutes),"/",t),e){await updateRole(this.role.key,this.role);for(let e=0;e<this.rolesList.length;e++)if(this.rolesList[e].key===this.role.key){this.rolesList.splice(e,1,Object.assign({},this.role));break}}else{const{data:e}=await addRole(this.role);this.role.key=e.key,this.rolesList.push(this.role)}const{description:i,key:s,name:l}=this.role;this.dialogVisible=!1,this.$notify({title:"Success",dangerouslyUseHTMLString:!0,message:`\n            <div>Role Key: ${s}</div>\n            <div>Role Name: ${l}</div>\n            <div>Description: ${i}</div>\n          `,type:"success"})},onlyOneShowingChild(e=[],t){let i=null;const s=e.filter(e=>!e.hidden);return 1===s.length?(i=s[0],i.path=r.a.resolve(t.path,i.path),i):0===s.length&&(i={...t,path:"",noShowingChildren:!0},i)}}},d=c,h=(i("8ba1"),i("2877")),u=Object(h["a"])(d,s,l,!1,null,"46c6e028",null);t["default"]=u.exports}}]);